# Лабораторная работа №1
## Коррелатный способ уравнивания нивелирных сетей

Цель: выполнить уравнивание коррелатным способом сеть нивелирования IV класса. Вычислить уравненные высотные отметки, произвести обобщенную оценку точности полученных результатов. 

Исходные данные, использованные в ходе лабораторной работы, представлены в таблицах 1 и 2.

Таблица 1 – Измеренные превышения
|Номер хода | h, м | L, км |
|:----------:|:-------------:|------:|
| 1 |  1,845 | 4,5 |
| 2 | -1,832 | 2,7 |
| 3 | -2,180 | 5,3 |
| 4 | -0,450 | 5,4 |
| 5 | 7,063 | 4,0 |
| 6 | -5,220 | 2,8 |
| 7 | 3,073 | 5,2 |
| 8 | -2,648 | 3,7 |

Таблица 2 – Высотные отметки исходых реперов
|Название репера | H, м |
|:----------:|:-------------:|
| М01 | 164,142 |
| М01 | 161,562 |

### Рисунок схемы сети!!

### Уравнивание нивелирной сети и определение уравненных отметок реперов

Проанализируем нивелирную сеть, приведенную на рисунке 1.

 1. В данной сети четыре избиточных измерения: $r=N-t=8-4=4$
 2. По числу избыточных измерений необходимо составить четыре условных уравнения поправок.

Условные уравнения поправок будут иметь вид:

$$
\begin{matrix}
   h_{2}+h_{5}+h_{6}=W_{1} \\
   h_{2}-h_{6}-h_{7}=W_{2} \\
   h_{4}+h_{7}+h_{8}=W_{3} \\
   h_{1}+h_{2}+h_{3}+h_{4} \cdot (H_{M_{02}}-H_{M_{01}}   )=W_{4}
\end{matrix}
$$

Создаем вектор невязок *W*

$$
W=
\begin{pmatrix}
0,011 \\
-0,033 \\
-0,025 \\
-0,037
\end{pmatrix}
$$

Вычисляем допустимые невязки реперов (для **IV** класса):

$$
w_{доп} = 20 \cdot \sqrt{L}
$$

где *L* - длина хода, км

$$
\begin{matrix}
w_{1_{доп}}=0,06164414 мм \\
w_{2_{доп}}=0,07293833 мм \\
w_{3_{доп}}=0,07563068 мм \\
w_{4_{доп}}=0,08461678 мм \\
\end{matrix}
$$

Все невязки допустимы.

Коэффициент при превышении равняется: 

 1. +1, если направление хода и полигона совпадают; 
 2. – 1, если направление хода и полигона не совпадают; 
 3. 0, если в полигоне нет данного хода.
   
Создадим матрицу коэффициентов условных уравнений поправок B:

$$
B=
\begin{bmatrix}
 & 0 & 1 & 0 & 0 & 1 & 1 & 0 & 0 &\\ 
 & 0 & 0 & 1 & 0 & 0 & -1 & -1 & 0 &\\  
 & 0 & 0 & 0 & 1 & 0 & 0 & 1 & 1 &\\ 
 & 1 & 1 & 1 & 1 & 0 & 0 & 0 & 0 &\\ 
\end{bmatrix}
$$

Создадим диагональную матрицу весов $P$
Где вес рассчитывается по формуле:

$$
P=\left(\frac{1}{\sigma_0 \cdot \sqrt{L}}\right)^2
$$

где $L$ – длина хода, км

$$
P= \begin{pmatrix}
555,555 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 925,925 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 471,698 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 462,962 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 625 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 892,857 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 480,769 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 675,675 \\
\end{pmatrix}
$$

Вычислим матрицу коэффициентов нормальных уравнений $R$

|  |  |  |  |  |
|:--:|:--:|:--:|:--:|:--:|
|| $B_1]$ | $B_2]$ | $B_3]$ |  $B_4]$ |
|$[qB_1$ | $R_{11}$ | $R_{12}$ | $R_{13}$ | $R_{14}$ |
|$[qB_2$ | $R_{21}$ | $R_{22}$ | $R_{23}$ | $R_{24}$ |
|$[qB_3$ | $R_{31}$ | $R_{32}$ | $R_{33}$ | $R_{34}$ |
|$[qB_4$ | $R_{41}$ | $R_{42}$ | $R_{43}$ | $R_{44}$ |

Где $q$ – обратный вес, который вычисляется по формуле

$$
q = \frac{1}{P}
$$

Расчёт матрицы коэффициентов нормальных уравнений $R$ в матричном виде

$$
R = B \cdot P^{-1} \cdot B^T
$$

$$
R= \begin{pmatrix} 
0,00380 & -0,00112 & 0 &  0,00108 \\
-0,00110 & 0,00532 & -0,00208 & 0,00210 \\
0 & -0,00208 & 0,00572 & 0,00216 \\
0,00100 & 0,00212 & 0,00216 & 0,00716
\end{pmatrix}
$$

Для вычисления коррелат, необходимо создать схему Гаусса: 
|             |          |                |                |                |               |
| ----------- | -------- | -------------- | -------------- | -------------- | ------------- |
|             | $K_1$    | $K_2$          | $K_3$          | $K_4$          | $w$           |
| $R_1$       | $R_{11}$ | $R_{12}$       | $R_{13}$       | $R_{14}$       | $w_1$         |
| $E_1 $      | $-1 $    | $E_{12}$       | $E_{13}$       | $E_{14}$       | $E_{w1}$      |
| $R_2$       |          | $R_{22}$       | $R_{23}$       | $R_{24}$       | $w_{2}$       |
| $R_2^{(1)}$ |          | $R_{22}^{(1)}$ | $R_{23}^{(1)}$ | $R_{24}^{(1)}$ | $w_{2}^{(1)}$ |
| $E_2$       |          | $-1$           | $E_{23}$       | $E_{24}$       | $E_{w2}$      |
| $R_3$       |          |                | $R_{33}$       | $E_{24}$       | $w_{3}$       |
| $R_3^{(2)}$ |          |                | $R_{33}^{(2)}$ | $E_{24}^{(2)}$ | $w_{3}^{(2)}$ |
| $E_3$       |          |                | $-1$           | $E_{34}$       | $E_{w3}$      |
| $R_4$       |          |                |                | $R_{44}$       | $w_{4}$       |
| $R_4^{(3)}$ |          |                |                | $R_{44}^{(3)}$ | $w_{4}^{(3)}$ |
| $E_4$       |          |                |                | $-1$           | $E_{w4}$      |

$R_i$ – эквивалентная строка;
$R_i^{(n)}$ – эквивалентная строка после n-го преобразования;
$E_i$ – элиминационная строка;

Например, элемент $E_{23}$ рассчитывается, как

$$
E_{23} = - \frac{R_{23}^{(1)}}{R_{22}^{(1)}}
$$

Элемент $R_{33}^{(2)}$ рассчитывается, как

$$
R_{33}^{(2)}=R_{13} \cdot E_{13} + R_{23}^{(1)} \cdot E_{23} + R_{33}
$$

Cхема Гаусса со значениями:

|  |  |  |  |  |  |
|:--:|:--:|:--:|:--:|:--:|:--:|
|  |$K_1$ | $K_2$ | $K_3$ | $K_4$ | $w$|
|$R_1$ | $0.00424$ | $-0.00112$ | $0$ | $0.00204$ | $-0.01700$|
|$E_1$ | $-1$ | $0.2947$ | $0$ | $-0.2842$ | $-2.8947$|
|$R_2$ |  |$0.00388$ | $-0.00172$ | $0.00104$ | $0.02800$|
|$R_2^{(1)}$ |  |$0.00358$ | $-0.00172$ | $0.00157$ | $0.02350$|
|$E_2$ |  |$-1$ | $0.4168$ | $0.4886$ | $5.9636$|
|$R_3$ |  |  |$0.00624$ | $0.00228$ | $-0.04600$|
|$R_3^{(2)}$ |  |  |$0.00541$ | $0.00303$ | $-0.03471$|
|$E_3$ |  |  |$-1$ | $-0.6545$ | $7.7075$|
|$R_4$ |  |  |  |$0.00756$ | $-0.04100$|
|$R_4^{(3)}$ |  |  |  |$0.00417$ | $-0.02369$|
|$E_4$ |  |  |  |$-1$ | $5.67139$|

Непосредственно сами коррелаты вычисляются следующим образом:

$$
\begin{matrix}
K_4=E_{w4} \\
K_3 = -E_{34} \cdot K_4 - E_{w3} \\
K_2 = -E_{23} \cdot K_3 - E_{24} \cdot K_4 - E_{w2} \\
K_1 = -E_{12} \cdot K_2 - E_{13} \cdot K_3 - E_{14} \cdot K_4 - E_{w1}
\end{matrix}
$$

Расчёт вектора коррелат К в матричном виде:

$$
K=-R^{-1} \cdot W
$$

$$
K=
\begin{pmatrix}
-0,34669819 \\
8.94201134 \\
7.50600909 \\
0.30787575
\end{pmatrix}
$$

Вычисляем уравненные поправки

$$
V=P^{-1} \cdot B^T \cdot K
$$

$$
V=
\begin{pmatrix}
0.00055418 \\
-0.00004193 \\
0.0960976 \\
0.01687799\\
-0.00055472 \\
-0.0001040335\\
-0.00298688\\
0.0111889
\end{pmatrix}
$$

Далее найдем уравненные превышения и рассчитаем по ним невязки.

$$
h_n^{ур}= h_n + \nu_n
$$

$$
\begin{pmatrix}
1.845 \\
-1.832 \\
-2.180 \\
-0.450 \\
7.063 \\
-5.220 \\
3.073 \\
2.648
\end{pmatrix} + V = \begin{pmatrix}
1.84555418\\
-1.84555418 \\
-2.16039024 \\
-0.43312201 \\
7.06244528 \\
-5.23040335 \\
3.07001312 \\
-2.63689111
\end{pmatrix}
$$

Теперь высчитаем невязки с уравненными превышениями: 

$$
\begin{matrix}
   h_{2}+h_{5}+h_{6} = 0\\
   h_{2}-h_{6}-h_{7} = 0 \\
   h_{4}+h_{7}+h_{8} = 0\\
   h_{1}+h_{2}+h_{3}+h_{4} \cdot (H_{M_{02}}-H_{M_{01}}   )= 0
\end{matrix}
$$

Все невязки равны 0.

Вычислим уравненные отметки реперов:

$$
\begin{cases}
H_1 = H_{M1} + h_1 = 165.9875542 м \\
H_2 = H_{M1} + h_1 + h_2 = 164.1555122 м \\
H_3 = H_{M2} - h_4 = 161.995122 м \\
H_4 = H_{M2} + h_8 = 158.9251089 м
\end{cases}
$$

### Оценка точности коррелатного способа уравнивания
Рассчитаем ковариационную матрицу уравненных превышений

$$
Q_{ур}^h = P^{-1} -  P^{-1} \cdot B^T \cdot R^{-1} \cdot B \cdot  P^{-1}
$$

$$
\begin{pmatrix}
0.00089 & -0.00026 & -0.00025 & -0.00037 & 0.00040 & -0.00014 & -0.00011 & 0.00048 \\
-0.00026 & 0.00067 & -0.00023 & -0.00016&  -0.00036 & -0.00030 & 0.00006 & 0.00010 \\
-0.00025 & -0.00023 & 0.00098 & -0.00049 & -0.00012 & 0.00035 & 0.00063 & -0.00013 \\
-0.00037 & -0.00016 & -0.00049 & 0.00104 & 0.00008 & 0.00008 & -0.00058 & -0.00045 \\
0.00040 & -0.00036 & -0.00012 & 0.00008 & 0.00068 & -0.00031 & 0.00019 & -0.00028 \\
-0.00014 & -0.00030 & 0.00035 & 0.00008 & -0.00031 & 0.00062 & -0.00026 & 0.00017 \\
-0.00011 & 0.00006 & 0.00063 & -0.00058 & 0.00019 & -0.00026 & 0.00089 & -0.00030 \\
0.00048 & 0.00010 & -0.00013 & -0.00045 & -0.00028 & 0.00017 & -0.00030 & 0.00076
\end{pmatrix}
$$

Рассчитаем ковариационную матрицу уравненных отметок реперов

$$
Q_{ур}^H = A \cdot Q_{ур}^h \cdot A^T
$$

$A$ - матрица частных производных;

Для составления матрицы $А$ используем формулу переноса ошибок

$$
F = f(a, b)
$$

$$
m_F^2 = \left(\frac{\partial F}{\partial a}\right)^2 \cdot m_a^2 + \left(\frac{\partial F}{\partial b}\right)^2 \cdot m_b^2
$$

Например, вторая строка матрицы А рассчитывается следующим образом
$$
H_3 = H_{M1} - h_4
$$

$$
m_{H_3}^2 =  \left(\frac{\partial f}{\partial h_1}\right)^2 \cdot m_{h_1}^2 + \left(\frac{\partial f}{\partial h_2}\right)^2 \cdot m_{h_2}^2 + \left(\frac{\partial f}{\partial h_3}\right)^2 \cdot m_{h_3}^2 + \left(\frac{\partial f}{\partial h_4}\right)^2 \cdot m_{h_4}^2 + \left(\frac{\partial f}{\partial h_5}\right)^2 \cdot m_{h_5}^2 + \left(\frac{\partial f}{\partial h_6}\right)^2 \cdot m_{h_6}^2 + \left(\frac{\partial f}{\partial h_7}\right)^2 \cdot m_{h_7}^2 + \left(\frac{\partial f}{\partial h_8}\right)^2 \cdot m_{h_8}^2 +
$$

$$
m_{H_3}^2 = 0^2 \cdot m_{h_1}^2 + 0^2 \cdot m_{h_2}^2 + 0^2 \cdot m_{h_3}^2 + (-1)^2 \cdot m_{h_4}^2 + 0^2 \cdot m_{h_5}^2 + 0^2 \cdot m_{h_6}^2 + 0^2 \cdot m_{h_7}^2 + 0^2 \cdot m_{h_8}^2
$$

$$
A = \begin{pmatrix}
1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 1
\end{pmatrix}
$$

$$
Q_{ур}^H = \begin{pmatrix} 
0.00089 & 0.00062 & 0.00037 & 0.00048 \\
0.00062 & 0.00103 & 0.00054 & 0.00058 \\
0.00037 & 0.00054 & 0.00104 & 0.00045 \\
0.00048 & 0.00058 & 0.00045 & 0.00076
\end{pmatrix}
$$

СКП единицы веса:

$$
\mu = \sqrt{\frac{V^T \cdot P \cdot V}{N  - t}}
$$

$\mu = 0.35282492$

СКП Превышений

$$
\begin{pmatrix}
m_{h1} \\
m_{h2} \\
m_{h3} \\
m_{h4} \\
m_{h5} \\
m_{h6} \\
m_{h7} \\
m_{h8} \\
\end{pmatrix}= \mu \cdot \begin{pmatrix} 
\sqrt{Q_{ур11}^h} \\
\sqrt{Q_{ур22}^h} \\
\sqrt{Q_{ур33}^h} \\
\sqrt{Q_{ур44}^h} \\
\sqrt{Q_{ур55}^h} \\
\sqrt{Q_{ур66}^h} \\
\sqrt{Q_{ур77}^h} \\
\sqrt{Q_{ур88}^h} \\
\end{pmatrix}  = \begin{pmatrix} 
0.01055892 \\
0.00913616\\
0.01108460 \\
0.01139561 \\
0.00926062 \\
0.00878621 \\
0.01056107 \\
0.00976960 \\
\end{pmatrix} 
$$

СКП реперов

$$
\begin{pmatrix} 
m_{H_1} \\
m_{H_2} \\
m_{H_3} \\
m_{H_4} \\
\end{pmatrix} = \mu \cdot \begin{pmatrix} 
\sqrt{Q_{ур11}^H} \\
\sqrt{Q_{ур11}^H} \\
\sqrt{Q_{ур11}^H} \\
\sqrt{Q_{ур11}^H} \\
\end{pmatrix} = \begin{pmatrix} 
0.01055892 \\
0.01133925 \\
0.01139561 \\ 
0.00976960
\end{pmatrix}
$$

**Вывод**: выполнив уравнивание коррелатным способом сеть нивелирования IV класса были определены уравненные отметки реперов и произведена оценка точности полученных результатов.
